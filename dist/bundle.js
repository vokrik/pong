(()=>{"use strict";var t={182:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(517);e.default=class{static convertCanvasToParticles(t,e,s,n){const o=[],r=n.getImageData(0,0,t,e);n.clearRect(0,0,t,e),s();const a=n.getImageData(0,0,t,e).data;n.putImageData(r,0,0);for(let s=0;s<e;s+=3)for(let e=0;e<t;e+=3){const r=4*(s*t+e),c=a[r],h=a[r+1],u=a[r+2];a[r+3]>0&&o.push(new i.default(e,s,3,`rgb(${c},${h},${u})`,n))}return o}}},239:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(440),n=s(454),o=s(231),r=s(602),a=s(66);e.default=class{constructor(){this.height=window.innerHeight,this.width=window.innerWidth,this.canvas=document.getElementById("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.actor=(0,n.createActor)(i.gamesState).start(),this.game=new o.default(this.width,this.height,this.actor,this.ctx),this.titleScreen=new r.default(this.width,this.height,this.actor,this.ctx),this.gameOverScreen=new a.default(this.width,this.height,this.actor,this.ctx)}setup(){this.registerKeyListeners()}registerKeyListeners(){document.addEventListener("keydown",(t=>{switch(t.key){case"ArrowDown":this.actor.send({type:"Press Down"});break;case"ArrowUp":this.actor.send({type:"Press Up"});break;case"Enter":this.actor.send({type:"Press Enter"})}})),document.addEventListener("keyup",(t=>{switch(t.key){case"ArrowDown":this.actor.send({type:"Release Down"});break;case"ArrowUp":this.actor.send({type:"Release Up"})}}))}render(){this.actor.send({type:"Tick"}),this.ctx.clearRect(0,0,this.width,this.height);const t=this.actor.getSnapshot();this.gameOverScreen.render(),t.matches("Title screen")?this.titleScreen.render():t.matches("Game over screen")?this.gameOverScreen.render():this.game.render()}}},780:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MAX_PADDLE_ANGLE=e.MOVEMENT_SPEED=e.WIN_SCORE=e.CAMERA_SHAKE_FRAMES=e.OPPONENT_IDLE_INCORRECTNESS=e.PADDLE_DISTANCE_FROM_SIDE_PERCENT=e.PADDLE_HEIGHT_PERCENT=e.PADDLE_WIDTH_PERCENT=e.BALL_RADIUS_PERCENT=e.FONT_SIZE_SUBTITLE_TO_HEIGHT_RATIO=e.FONT_SIZE_TITLE_TO_HEIGHT_RATIO=e.GAME_BALL_SPEED=e.TITLE_SCREEN_BALL_SPEED=void 0,e.TITLE_SCREEN_BALL_SPEED=.03,e.GAME_BALL_SPEED=.05,e.FONT_SIZE_TITLE_TO_HEIGHT_RATIO=.15,e.FONT_SIZE_SUBTITLE_TO_HEIGHT_RATIO=.03,e.BALL_RADIUS_PERCENT=.015,e.PADDLE_WIDTH_PERCENT=.018,e.PADDLE_HEIGHT_PERCENT=.25,e.PADDLE_DISTANCE_FROM_SIDE_PERCENT=.1,e.OPPONENT_IDLE_INCORRECTNESS=.8,e.CAMERA_SHAKE_FRAMES=6,e.WIN_SCORE=3,e.MOVEMENT_SPEED=.004,e.MAX_PADDLE_ANGLE=.9},534:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(780);e.default=class{constructor(t,e,s){this.intensity=0,this.remainingFrames=0,this.ctx=s,this.width=t,this.height=e}startShake(t){this.remainingFrames=i.CAMERA_SHAKE_FRAMES,this.intensity=t}use(){if(this.remainingFrames<=0)return;const t=Math.round(Math.cos(Math.PI/6*this.remainingFrames)*this.intensity),e=this.ctx.getImageData(0,0,this.width,this.height);this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.putImageData(e,t,0),this.remainingFrames-=1}}},489:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{static use(t,e){t.map((t=>{const s=e.x-t.x,i=e.y-t.y,n=Math.sqrt(s*s+i*i);if(n<3*e.radius){const o=-e.radius/n*10,r=Math.sign(o)*Math.min(Math.abs(o),50),a=Math.atan2(i,s),c=r*Math.cos(a),h=r*Math.sin(a);t.setVelocity(c,h)}t.vx=t.vx*t.friction+(t.targetPositionX-t.x)*t.ease,t.vy=t.vy*t.friction+(t.targetPositionY-t.y)*t.ease}))}}},611:(t,e)=>{var s;Object.defineProperty(e,"__esModule",{value:!0}),e.TransitionType=void 0,function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT"}(s||(e.TransitionType=s={})),e.default=class{constructor(t,e,s,i){this.width=t,this.height=e,this.actor=s,this.ctx=i,this.particles=[]}startTransition(t,e){this.particles=e,t===s.IN?this.startIn():this.startOut()}startIn(){this.particles.forEach((t=>{t.x=Math.random()*this.width,t.y=Math.random()*this.height}))}startOut(){this.particles.forEach((t=>{t.targetPositionX=Math.random()*this.width,t.targetPositionY=Math.random()*this.height}))}use(){const t=this.actor.getSnapshot();this.particles.forEach((e=>{e.vx=e.vx*e.friction+(e.targetPositionX-e.x)*e.ease,e.vy=e.vy*e.friction+(e.targetPositionY-e.y)*e.ease,e.update(t.context.elapsedTimeMs),e.draw()}))}}},956:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(780);e.default=class{constructor(t,e,s,n){this.ctx=n,this.radius=Math.min(t*i.BALL_RADIUS_PERCENT,e*i.BALL_RADIUS_PERCENT),this.speed=s*this.radius,this.isActive=!1}stopAndHide(){this.isActive=!1}start(t,e){this.direction=e.clone().normalise(),this.position=t,this.previousPosition=t,this.isActive=!0}getTraveledCollisionLine(){return this.isActive?{pointA:this.getDirectionalOuterPoint(this.position),pointB:this.getDirectionalOuterPoint(this.previousPosition)}:null}getDirectionalOuterPoint(t){return{x:t.x+this.direction.x*this.radius,y:t.y+this.direction.y*this.radius}}update(t){this.isActive&&(this.previousPosition=this.position,this.position={x:this.position.x+this.direction.x*this.speed*t,y:this.position.y+this.direction.y*this.speed*t})}setPosition(t){this.position=t}setDirection(t){this.direction=t}bounce(t,e){if(!this.isActive)return;this.position={x:t.x-this.direction.x*this.radius,y:t.y-this.direction.y*this.radius};const s=2*e.dot(this.direction);this.direction.x=this.direction.x-s*e.x,this.direction.y=this.direction.y-s*e.y}render(){this.isActive&&(this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI),this.ctx.fill())}}},897:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Bounds=e.BOUNDS_TYPE=e.SIDE=void 0;const i=s(443);var n,o;!function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP"}(n||(e.SIDE=n={})),function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"}(o||(e.BOUNDS_TYPE=o={})),e.Bounds=class{constructor(t,e){this.box=t,this.type=e}getBoxCollision(t){const e=[{collisionPoint:this.intersectionOf2Lines(t,{pointA:this.box.tl,pointB:this.box.bl}),side:n.LEFT},{collisionPoint:this.intersectionOf2Lines(t,{pointA:this.box.tr,pointB:this.box.br}),side:n.RIGHT},{collisionPoint:this.intersectionOf2Lines(t,{pointA:this.box.tl,pointB:this.box.tr}),side:n.TOP},{collisionPoint:this.intersectionOf2Lines(t,{pointA:this.box.bl,pointB:this.box.br}),side:n.BOTTOM}].filter((t=>!!t.collisionPoint));return e.length?(e.sort(((e,s)=>{const i=t.pointA.x-e.collisionPoint.x,n=t.pointA.y-e.collisionPoint.y,o=t.pointA.x-s.collisionPoint.x,r=t.pointA.y-s.collisionPoint.y;return o*o+r*r-(i*i+n*n)})),e[0]):null}intersectionOf2Lines(t,e){if(t.pointA.x===t.pointB.x&&t.pointA.y===t.pointB.y||e.pointA.x===e.pointB.x&&e.pointA.y===e.pointB.y)return null;const s=(e.pointB.y-e.pointA.y)*(t.pointB.x-t.pointA.x)-(e.pointB.x-e.pointA.x)*(t.pointB.y-t.pointA.y);if(0===s)return null;let i=((e.pointB.x-e.pointA.x)*(t.pointA.y-e.pointA.y)-(e.pointB.y-e.pointA.y)*(t.pointA.x-e.pointA.x))/s,n=((t.pointB.x-t.pointA.x)*(t.pointA.y-e.pointA.y)-(t.pointB.y-t.pointA.y)*(t.pointA.x-e.pointA.x))/s;return i<0||i>1||n<0||n>1?null:{x:t.pointA.x+i*(t.pointB.x-t.pointA.x),y:t.pointA.y+i*(t.pointB.y-t.pointA.y)}}getSideNormal(t){const e=o.INNER?1:-1;switch(t){case n.LEFT:return new i.Vector(1*e,0);case n.RIGHT:return new i.Vector(-1*e,0);case n.TOP:return new i.Vector(0,1*e);case n.BOTTOM:return new i.Vector(0,-1*e)}}}},586:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(897),n=s(780);e.default=class{constructor(t,e,s,i,o){this.ctx=o,this.position=t,this.position=t,this.activeSide=e,this.width=s,this.height=i,this.speed=n.MOVEMENT_SPEED*i}moveUp(t){this.position.y-=this.speed*t}moveDown(t){this.position.y+=this.speed*t}getBounds(){return new i.Bounds({tl:{x:this.position.x,y:this.position.y},tr:{x:this.position.x+this.width,y:this.position.y},bl:{x:this.position.x,y:this.position.y+this.height},br:{x:this.position.x+this.width,y:this.position.y+this.height}},i.BOUNDS_TYPE.OUTER)}getCenter(){return{x:this.position.x+this.width/2,y:this.position.y+this.height/2}}getNormalRotationAtPoint(t){const e=this.height/2,s=this.position.y+e,o=t.y-s,r=this.activeSide===i.SIDE.LEFT?-1:1;return n.MAX_PADDLE_ANGLE*(o/e)*r}moveToVerticalPosition(t,e=!0){this.position.y=e?t:t-this.height}render(){this.ctx.fillStyle="white",this.ctx.fillRect(this.position.x,this.position.y,this.width,this.height)}}},517:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e,s,i,n){this.ctx=n,this.color=i,this.size=s,this.x=t,this.y=e,this.targetPositionX=t,this.targetPositionY=e,this.vx=0,this.vy=0,this.ease=.05,this.friction=.2*Math.random()+.7}setVelocity(t,e){this.vx=t,this.vy=e}update(t){this.x+=this.vx*t*.07,this.y+=this.vy*t*.07}draw(){this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x,this.y,this.size,this.size)}}},883:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(182),n=s(780),o=s(489);e.default=class{constructor(t,e,s,i){this.particles=[],this.width=t,this.height=e,this.actor=s,this.ctx=i,this.score=this.actor.getSnapshot().context.score,this.convertScoreToParticles()}convertScoreToParticles(){this.particles=i.default.convertCanvasToParticles(this.width,this.height,(()=>{const t=Math.ceil(this.height*n.FONT_SIZE_TITLE_TO_HEIGHT_RATIO);this.ctx.fillStyle="white",this.ctx.font=`${t}px Silkscreen`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillText(`${this.score.player} : ${this.score.opponent}`,this.width/2,this.height/2),this.ctx.beginPath(),this.ctx.strokeStyle="white",this.ctx.setLineDash([5,15]),this.ctx.lineWidth=3,this.ctx.moveTo(this.width/2-1,0),this.ctx.lineTo(this.width/2,this.height/2-150),this.ctx.stroke(),this.ctx.moveTo(this.width/2-1,this.height/2+150),this.ctx.lineTo(this.width/2,this.height),this.ctx.stroke()}),this.ctx)}setCollisionPoint(t){this.collisionPoint=t}update(){const t=this.actor.getSnapshot();this.score.player===t.context.score.player&&this.score.opponent===t.context.score.opponent||(this.score=t.context.score,this.convertScoreToParticles()),o.default.use(this.particles,{x:this.collisionPoint.x,y:this.collisionPoint.y,radius:this.collisionPoint.radius}),this.particles.forEach((e=>e.update(t.context.elapsedTimeMs)))}render(){this.particles.map((t=>t.draw()))}}},231:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(586),n=s(956),o=s(443),r=s(897),a=s(780),c=s(883),h=s(534),u=s(741),l=s(182);class d extends u.Screen{constructor(t,e,s,u){super("Game screen",t,e,s,u);const l=this.width*a.PADDLE_WIDTH_PERCENT,d=this.height*a.PADDLE_HEIGHT_PERCENT,p=this.width*a.PADDLE_DISTANCE_FROM_SIDE_PERCENT,f=e/2-d/2;this.boardBounds=new r.Bounds({tl:{x:0,y:0},tr:{x:t,y:0},bl:{x:0,y:e},br:{x:t,y:e}},r.BOUNDS_TYPE.INNER),this.player=new i.default({x:p,y:f},r.SIDE.RIGHT,l,d,this.ctx),this.opponent=new i.default({x:t-p-l,y:f},r.SIDE.LEFT,l,d,this.ctx),this.ball=new n.default(this.width,this.height,a.GAME_BALL_SPEED,this.ctx),this.ball.start({x:t/2,y:e/2},new o.Vector(-10,0)),this.score=new c.default(this.width,this.height,this.actor,this.ctx),this.cameraShakeEffect=new h.default(this.width,this.height,this.ctx)}movePlayer(t){t.matches({"Game screen":{Idle:{Player:"Moving up"}}})&&this.player.moveUp(t.context.elapsedTimeMs),t.matches({"Game screen":{Idle:{Player:"Moving down"}}})&&this.player.moveDown(t.context.elapsedTimeMs)}resolveCollisions(){this.resolvePaddleCollisionsWithBounds(),this.resolveBallCollisions()}resolvePaddleCollisionsWithBounds(){let t=this.player.getBounds(),e=this.opponent.getBounds();const s=this.boardBounds.getBoxCollision({pointA:t.box.tr,pointB:t.box.br});s&&(s.side===r.SIDE.TOP?this.player.moveToVerticalPosition(0):this.player.moveToVerticalPosition(this.height,!1));const i=this.boardBounds.getBoxCollision({pointA:e.box.tr,pointB:e.box.br});i&&(i.side===r.SIDE.TOP?this.opponent.moveToVerticalPosition(0):this.opponent.moveToVerticalPosition(this.height,!1))}resolveBallCollisions(){this.ball.getTraveledCollisionLine()&&(this.resolveBallCollisionsWithPaddle(this.player),this.resolveBallCollisionsWithPaddle(this.opponent),this.resolveBallCollisionWithBounds(),this.score.setCollisionPoint({x:this.ball.position.x,y:this.ball.position.y,radius:this.ball.radius}))}resolveBallCollisionsWithPaddle(t){const e=t.getBounds(),s=this.ball.getTraveledCollisionLine(),i=e.getBoxCollision(s);if(i&&i.side===t.activeSide){const s=i.collisionPoint;s.x=i.side===r.SIDE.RIGHT?s.x+this.ball.radius:s.x-this.ball.radius,this.ball.setPosition(s),this.ball.setDirection(e.getSideNormal(t.activeSide).rotate(t.getNormalRotationAtPoint(i.collisionPoint)))}}resolveBallCollisionWithBounds(){const t=this.ball.getTraveledCollisionLine(),e=this.boardBounds.getBoxCollision(t);e&&(this.ball.bounce(e.collisionPoint,this.boardBounds.getSideNormal(e.side)),[r.SIDE.LEFT,r.SIDE.RIGHT].includes(e.side)&&this.resolveSideWallHit(e.collisionPoint,e.side===r.SIDE.LEFT))}resolveSideWallHit(t,e){e?this.actor.send({type:"Opponent Score"}):this.actor.send({type:"Player Score"}),this.cameraShakeEffect.startShake(5),this.ball.stopAndHide(),setTimeout((()=>{const t=e?this.opponent:this.player,s={x:this.width/2,y:this.height/2},i=t.getCenter(),n=new o.Vector(i.x-s.x,i.y-s.y);this.ball.start(s,n.unit())}),500)}idleUpdate(){const t=this.actor.getSnapshot();this.movePlayer(t),this.moveOpponent(t),this.ball.update(t.context.elapsedTimeMs),this.resolveCollisions(),this.score.update()}getTransitionParticles(){return l.default.convertCanvasToParticles(this.width,this.height,(()=>{this.player.render(),this.opponent.render(),this.score.render()}),this.ctx)}moveOpponent(t){const e=this.opponent.getCenter().y-this.ball.position.y;Math.abs(e)<30||Math.random()<a.OPPONENT_IDLE_INCORRECTNESS||(Math.sign(e)<0?this.opponent.moveDown(t.context.elapsedTimeMs):this.opponent.moveUp(t.context.elapsedTimeMs))}idleRender(){this.update(),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.width,this.height),this.player.render(),this.opponent.render(),this.ball.render(),this.score.render(),this.cameraShakeEffect.use()}}e.default=d},66:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(780),n=s(741),o=s(182);class r extends n.Screen{constructor(t,e,s,i){super("Game over screen",t,e,s,i)}getTransitionParticles(){return o.default.convertCanvasToParticles(this.width,this.height,(()=>{this.idleRender()}),this.ctx)}idleRender(){const t=this.actor.getSnapshot().context.score.player>=i.WIN_SCORE,e=Math.ceil(this.height*i.FONT_SIZE_TITLE_TO_HEIGHT_RATIO),s=Math.ceil(this.height*i.FONT_SIZE_SUBTITLE_TO_HEIGHT_RATIO);this.ctx.fillStyle="white",this.ctx.font=`${e}px Silkscreen`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t?"Congrats!!!":"Oh no :(",this.width/2,this.height/2),this.ctx.font=`${s}px Silkscreen`,this.ctx.fillText(t?"You rock! The computer never had a chance.":"The computer has won this time.",this.width/2,this.height/2+150)}idleUpdate(){}}e.default=r},741:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Screen=void 0;const i=s(611);e.Screen=class{constructor(t,e,s,n,o){this.name=t,this.width=e,this.height=s,this.ctx=o,this.actor=n,this.hasTransitionStarted=!1,this.transitionEffect=new i.default(e,s,n,o)}update(){const t=this.actor.getSnapshot();t.matches({[this.name]:"Transition In"})&&(this.hasTransitionStarted||(console.log("Starting transition in"),this.transitionEffect.startTransition(i.TransitionType.IN,this.getTransitionParticles()),this.hasTransitionStarted=!0),this.transitionEffect.use()),t.matches({[this.name]:"Idle"})&&(this.hasTransitionStarted=!1,this.idleUpdate()),t.matches({[this.name]:"Transition Out"})&&(this.hasTransitionStarted||(console.log("Starting transition out"),this.transitionEffect.startTransition(i.TransitionType.OUT,this.getTransitionParticles()),this.hasTransitionStarted=!0),this.transitionEffect.use())}render(){this.update(),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.width,this.height);const t=this.actor.getSnapshot();t.matches({[this.name]:"Transition In"})&&(this.hasTransitionStarted||(this.transitionEffect.startTransition(i.TransitionType.IN,this.getTransitionParticles()),this.hasTransitionStarted=!0),this.transitionEffect.use()),t.matches({[this.name]:"Idle"})&&(this.hasTransitionStarted=!1,this.idleRender()),t.matches({[this.name]:"Transition Out"})&&(this.hasTransitionStarted||(this.transitionEffect.startTransition(i.TransitionType.OUT,this.getTransitionParticles()),this.hasTransitionStarted=!0),this.transitionEffect.use())}}},602:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(489),n=s(182),o=s(956),r=s(443),a=s(897),c=s(780),h=s(741);class u extends h.Screen{constructor(t,e,s,i){super("Title screen",t,e,s,i),this.particles=n.default.convertCanvasToParticles(this.width,this.height,(()=>{const s=Math.ceil(this.height*c.FONT_SIZE_TITLE_TO_HEIGHT_RATIO),i=Math.ceil(this.height*c.FONT_SIZE_SUBTITLE_TO_HEIGHT_RATIO);this.ctx.fillStyle="white",this.ctx.font=`${s}px Silkscreen`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.clearRect(0,0,t,e),this.ctx.fillText("Particle Pong",this.width/2,this.height/2),this.ctx.font=`${i}px Silkscreen`,this.ctx.fillText("*Press Enter to start*",this.width/2,this.height/2+1.5*s)}),this.ctx),this.mouse={x:void 0,y:void 0},document.addEventListener("mousemove",(t=>{this.mouse.x=t.x,this.mouse.y=t.y})),this.bounds=new a.Bounds({tl:{x:0,y:0},tr:{x:t,y:0},bl:{x:0,y:e},br:{x:t,y:e}},a.BOUNDS_TYPE.INNER),this.ball=new o.default(this.width,this.height,c.TITLE_SCREEN_BALL_SPEED,i),this.ball.start({x:this.width/2,y:this.height/2},new r.Vector(1,0).rotate(Math.PI/3))}getTransitionParticles(){return this.particles}idleUpdate(){const t=this.actor.getSnapshot();this.ball.update(t.context.elapsedTimeMs);const e=this.ball.getTraveledCollisionLine(),s=this.bounds.getBoxCollision(e);s&&this.ball.bounce(s.collisionPoint,this.bounds.getSideNormal(s.side)),i.default.use(this.particles,{x:this.ball.position.x,y:this.ball.position.y,radius:this.ball.radius}),i.default.use(this.particles,{x:this.mouse.x,y:this.mouse.y,radius:this.ball.radius}),this.particles.forEach((e=>e.update(t.context.elapsedTimeMs)))}idleRender(){this.particles.map((t=>t.draw())),this.ball.render()}}e.default=u},440:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.gamesState=void 0;const i=s(454),n=s(780);e.gamesState=(0,i.createMachine)({context:{lastTickTime:performance.now(),currentTickTime:performance.now(),elapsedTimeMs:0,ticks:0,score:{player:0,opponent:0}},id:"Game state",initial:"Title screen",states:{"Title screen":{initial:"Transition In",states:{"Transition In":{after:{500:{target:"#Game state.Title screen.Idle",actions:[]}}},Idle:{on:{"Press Enter":{target:"#Game state.Title screen.Transition Out"}}},"Transition Out":{after:{300:{target:"#Game state.Game screen",actions:[]}}}}},"Game screen":{initial:"Transition In",states:{"Transition In":{after:{1e3:{target:"#Game state.Game screen.Idle",actions:[]}}},Idle:{initial:"Player",states:{Player:{initial:"Idle",states:{Idle:{on:{"Press Up":{target:"Moving up"},"Press Down":{target:"Moving down"}}},"Moving up":{on:{"Release Up":{target:"Idle"}}},"Moving down":{on:{"Release Down":{target:"Idle"}}}}}},always:[{target:"#Game state.Game screen.Transition Out",guard:"Player Win Guard"},{target:"#Game state.Game screen.Transition Out",guard:"Player Loose Guard"}],type:"parallel"},"Transition Out":{after:{500:{target:"#Game state.Game over screen",actions:[]}}}}},"Game over screen":{initial:"Transition In",states:{"Transition In":{after:{500:{target:"#Game state.Game over screen.Idle",actions:[]}}},Idle:{}}}},on:{Tick:{actions:(0,i.assign)((({context:t})=>{const e=t.currentTickTime,s=performance.now();return{lastTickTime:e,currentTickTime:s,elapsedTimeMs:Math.min(s-e,50),ticks:t.ticks+1}}))},"Player Score":{actions:(0,i.assign)((({context:t})=>Object.assign(Object.assign({},t),{score:{player:t.score.player+1,opponent:t.score.opponent}})))},"Opponent Score":{actions:(0,i.assign)((({context:t})=>Object.assign(Object.assign({},t),{score:{player:t.score.player,opponent:t.score.opponent+1}})))}},types:{events:{},context:{}}},{actions:{},actors:{},guards:{"Player Win Guard":({context:t,event:e},s)=>t.score.player>=n.WIN_SCORE,"Player Loose Guard":({context:t,event:e},s)=>t.score.opponent>=n.WIN_SCORE},delays:{}})},412:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var s=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10],i=function(){function t(t){this.ctor=t}return t.prototype.setAxes=function(t,e){return this.x=t,this.y=e,this},t.prototype.getX=function(){return this.x},t.prototype.setX=function(t){return this.x=t,this},t.prototype.getY=function(){return this.y},t.prototype.setY=function(t){return this.y=t,this},t.prototype.toString=function(t){return void 0===t&&(t=!1),t?"("+Math.round(this.x)+", "+Math.round(this.y)+")":"("+this.x+", "+this.y+")"},t.prototype.toArray=function(){return[this.x,this.y]},t.prototype.toObject=function(){return{x:this.x,y:this.y}},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.multiplyByVector=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.mulV=function(t){return this.multiplyByVector(t)},t.prototype.divideByVector=function(t){return this.x/=t.x,this.y/=t.y,this},t.prototype.divV=function(t){return this.divideByVector(t)},t.prototype.multiplyByScalar=function(t){return this.x*=t,this.y*=t,this},t.prototype.mulS=function(t){return this.multiplyByScalar(t)},t.prototype.divideByScalar=function(t){return this.x/=t,this.y/=t,this},t.prototype.divS=function(t){return this.divideByScalar(t)},t.prototype.normalise=function(){return this.divideByScalar(this.magnitude())},t.prototype.normalize=function(){return this.normalise()},t.prototype.unit=function(){return this.normalise()},t.prototype.magnitude=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.length=function(){return this.magnitude()},t.prototype.lengthSq=function(){var t=this.x,e=this.y;return t*t+e*e},t.prototype.dot=function(t){return t.x*this.x+t.y*this.y},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},t.prototype.zero=function(){return this.x=this.y=0,this},t.prototype.distance=function(t){var e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)},t.prototype.rotate=function(t){var e=Math.cos(t),s=Math.sin(t),i=this.x,n=this.y;return this.x=i*e-n*s,this.y=i*s+n*e,this},t.prototype.round=function(t){void 0===t&&(t=2);var e=s[t];return this.x=(.5+this.x*e<<0)/e,this.y=(.5+this.y*e<<0)/e,this},t.prototype.clone=function(){return new this.ctor(this.x,this.y)},t}();e.AbstractVector=i},700:function(t,e,s){var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(s,i){var n=t.call(this,e)||this;return n.axes=[s,i],n.ctor=e,n}return n(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.axes[0]},set:function(t){this.axes[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.axes[1]},set:function(t){this.axes[1]=t},enumerable:!0,configurable:!0}),e}(s(412).AbstractVector);e.ArrayVector=o},550:function(t,e,s){var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(s,i){var n=t.call(this,e)||this;return n.axes=new Float32Array(2),n.axes[0]=s,n.axes[1]=i,n}return n(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.axes[0]},set:function(t){this.axes[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.axes[1]},set:function(t){this.axes[1]=t},enumerable:!0,configurable:!0}),e}(s(412).AbstractVector);e.Float32Vector=o},443:(t,e,s)=>{function i(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),i(s(412)),i(s(700)),i(s(550)),i(s(615))},615:function(t,e,s){var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},function(t,e){function s(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(s,i){var n=t.call(this,e)||this;return n._x=s,n._y=i,n}return n(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),e}(s(412).AbstractVector);e.Vector=o},454:(t,e,s)=>{s.r(e),s.d(e,{Actor:()=>D,SimulatedClock:()=>Ee,SpecialTargets:()=>de,StateMachine:()=>Me,StateNode:()=>Ae,__unsafe_getAllOwnEventDescriptors:()=>k,and:()=>K,assign:()=>le,cancel:()=>$,createActor:()=>B,createEmptyActor:()=>ce,createMachine:()=>Ne,enqueueActions:()=>xe,forwardTo:()=>_e,fromCallback:()=>Kt,fromEventObservable:()=>ie,fromObservable:()=>se,fromPromise:()=>re,fromTransition:()=>Xt,getStateNodes:()=>_t,interpret:()=>C,isMachineSnapshot:()=>jt,log:()=>be,matchesState:()=>v,not:()=>X,or:()=>tt,pathToStateValue:()=>x,raise:()=>Jt,sendParent:()=>ve,sendTo:()=>ge,setup:()=>De,spawnChild:()=>V,stateIn:()=>z,stop:()=>q,stopChild:()=>W,toObserver:()=>O,toPromise:()=>Be,waitFor:()=>Re});const i=t=>{if("undefined"==typeof window)return;const e=function(){const t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s.g?s.g:void 0;if(t.__xstate__)return t.__xstate__}();e&&e.register(t)};class n{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(t){const e={value:t,next:null};if(this._current)return this._last.next=e,void(this._last=e);this._current=e,this._last=e,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),this._current=t.next}this._last=null}}const o=".",r="",a="xstate.init",c="xstate.error",h="xstate.stop";function u(t,e){return{type:`xstate.done.state.${t}`,output:e}}function l(t,e){return{type:`xstate.error.actor.${t}`,error:e}}function d(t){return{type:a,input:t}}function p(t){setTimeout((()=>{throw t}))}const f="function"==typeof Symbol&&Symbol.observable||"@@observable";function y(t,e){return`${t.sessionId}.${e}`}let g=0;function v(t,e){const s=m(t),i=m(e);return"string"==typeof i?"string"==typeof s&&i===s:"string"==typeof s?s in i:Object.keys(s).every((t=>t in i&&v(s[t],i[t])))}function _(t){return w(t)?t:t.split(o)}function m(t){return jt(t)?t.value:"string"!=typeof t?t:x(_(t))}function x(t){if(1===t.length)return t[0];const e={};let s=e;for(let e=0;e<t.length-1;e++)if(e===t.length-2)s[t[e]]=t[e+1];else{const i=s;s={},i[t[e]]=s}return e}function S(t,e){const s={},i=Object.keys(t);for(let n=0;n<i.length;n++){const o=i[n];s[o]=e(t[o],o,t,n)}return s}function T(t){return w(t)?t:[t]}function b(t){return void 0===t?[]:T(t)}function E(t,e,s,i){return"function"==typeof t?t({context:e,event:s,self:i}):t}function w(t){return Array.isArray(t)}function P(t){return T(t).map((t=>void 0===t||"string"==typeof t?{target:t}:t))}function I(t){if(void 0!==t&&t!==r)return b(t)}function O(t,e,s){const i="object"==typeof t,n=i?t:void 0;return{next:(i?t.next:t)?.bind(n),error:(i?t.error:e)?.bind(n),complete:(i?t.complete:s)?.bind(n)}}function A(t,e){return`${e}.${t}`}function M(t,e){const s=e.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!s)return t.implementations.actors[e];const[,i,n]=s,o=t.getStateNodeById(n).config.invoke;return(Array.isArray(o)?o[i]:o).src}function k(t){return[...new Set([...t._nodes.flatMap((t=>t.ownEvents))])]}let R=function(t){return t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped",t}({});const N={clock:{setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t)},logger:console.log.bind(console),devTools:!1};class D{constructor(t,e){this.logic=t,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new n(this._process.bind(this)),this.observers=new Set,this.logger=void 0,this._processingStatus=R.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const s={...N,...e},{clock:i,logger:o,parent:r,syncSnapshot:a,id:c,systemId:h,inspect:u}=s;this.system=r?r.system:function(t,e){const s=new Map,i=new Map,n=new WeakMap,o=new Set,r={},a=e.clock,c={schedule:(t,e,s,i,n=Math.random().toString(36).slice(2))=>{const o={source:t,target:e,event:s,delay:i,id:n,startedAt:Date.now()},c=y(t,n);h._snapshot._scheduledEvents[c]=o;const u=a.setTimeout((()=>{delete r[c],delete h._snapshot._scheduledEvents[c],h._relay(t,e,s)}),i);r[c]=u},cancel:(t,e)=>{const s=y(t,e),i=r[s];delete r[s],delete h._snapshot._scheduledEvents[s],a.clearTimeout(i)},cancelAll:t=>{for(const e in h._snapshot._scheduledEvents){const s=h._snapshot._scheduledEvents[e];s.source===t&&c.cancel(t,s.id)}}},h={_snapshot:{_scheduledEvents:(e?.snapshot&&e.snapshot.scheduler)??{}},_bookId:()=>"x:"+g++,_register:(t,e)=>(s.set(t,e),t),_unregister:t=>{s.delete(t.sessionId);const e=n.get(t);void 0!==e&&(i.delete(e),n.delete(t))},get:t=>i.get(t),_set:(t,e)=>{const s=i.get(t);if(s&&s!==e)throw new Error(`Actor with system ID '${t}' already exists.`);i.set(t,e),n.set(e,t)},inspect:t=>{o.add(t)},_sendInspectionEvent:e=>{const s={...e,rootId:t.sessionId};o.forEach((t=>t.next?.(s)))},_relay:(t,e,s)=>{h._sendInspectionEvent({type:"@xstate.event",sourceRef:t,actorRef:e,event:s}),e._send(s)},scheduler:c,getSnapshot:()=>({_scheduledEvents:{...h._snapshot._scheduledEvents}}),start:()=>{const t=h._snapshot._scheduledEvents;h._snapshot._scheduledEvents={};for(const e in t){const{source:s,target:i,event:n,delay:o,id:r}=t[e];c.schedule(s,i,n,o,r)}}};return h}(this,{clock:i}),u&&!r&&this.system.inspect(O(u)),this.sessionId=this.system._bookId(),this.id=c??this.sessionId,this.logger=o,this.clock=i,this._parent=r,this._syncSnapshot=a,this.options=s,this.src=s.src??t,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:t=>{this._deferred.push(t)},system:this.system,stopChild:t=>{if(t._parent!==this)throw new Error(`Cannot stop child actor ${t.id} of ${this.id} because it is not a child`);t._stop()}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),h&&(this._systemId=h,this.system._set(h,this)),this._initState(e?.snapshot??e?.state),h&&"active"!==this._snapshot.status&&this.system._unregister(this)}_initState(t){try{this._snapshot=t?this.logic.restoreSnapshot?this.logic.restoreSnapshot(t,this._actorScope):t:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(t){this._snapshot={status:"error",output:void 0,error:t}}}update(t,e){let s;for(this._snapshot=t;s=this._deferred.shift();)try{s()}catch(e){this._deferred.length=0,this._snapshot={...t,status:"error",error:e}}switch(this._snapshot.status){case"active":for(const e of this.observers)try{e.next?.(t)}catch(t){p(t)}break;case"done":for(const e of this.observers)try{e.next?.(t)}catch(t){p(t)}this._stopProcedure(),this._complete(),this._doneEvent={type:`xstate.done.actor.${this.id}`,output:this._snapshot.output},this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error)}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:e,snapshot:t})}subscribe(t,e,s){const i=O(t,e,s);if(this._processingStatus!==R.Stopped)this.observers.add(i);else switch(this._snapshot.status){case"done":try{i.complete?.()}catch(t){p(t)}break;case"error":{const t=this._snapshot.error;if(i.error)try{i.error(t)}catch(t){p(t)}else p(t);break}}return{unsubscribe:()=>{this.observers.delete(i)}}}start(){if(this._processingStatus===R.Running)return this;this._syncSnapshot&&this.subscribe({next:t=>{"active"===t.status&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:t})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=R.Running;const t=d(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:t}),this._snapshot.status){case"done":return this.update(this._snapshot,t),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(t){return this._snapshot={...this._snapshot,status:"error",error:t},this._error(t),this}return this.update(this._snapshot,t),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(t){let e,s;try{e=this.logic.transition(this._snapshot,t,this._actorScope)}catch(t){s={err:t}}if(s){const{err:t}=s;return this._snapshot={...this._snapshot,status:"error",error:t},void this._error(t)}this.update(e,t),t.type===h&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===R.Stopped?this:(this.mailbox.clear(),this._processingStatus===R.NotStarted?(this._processingStatus=R.Stopped,this):(this.mailbox.enqueue({type:h}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(const t of this.observers)try{t.complete?.()}catch(t){p(t)}this.observers.clear()}_reportError(t){if(!this.observers.size)return void(this._parent||p(t));let e=!1;for(const s of this.observers){const i=s.error;e||=!i;try{i?.(t)}catch(t){p(t)}}this.observers.clear(),e&&p(t)}_error(t){this._stopProcedure(),this._reportError(t),this._parent&&this.system._relay(this,this._parent,l(this.id,t))}_stopProcedure(){return this._processingStatus!==R.Running||(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new n(this._process.bind(this)),this._processingStatus=R.Stopped,this.system._unregister(this)),this}_send(t){this._processingStatus!==R.Stopped&&this.mailbox.enqueue(t)}send(t){this.system._relay(void 0,this,t)}attachDevTools(){const{devTools:t}=this.options;t&&("function"==typeof t?t:i)(this)}toJSON(){return{xstate$$type:1,id:this.id}}getPersistedSnapshot(t){return this.logic.getPersistedSnapshot(this._snapshot,t)}[f](){return this}getSnapshot(){return this._snapshot}}function B(t,e){return new D(t,e)}const C=B;function L(t,e,s,i,{sendId:n}){return[e,"function"==typeof n?n(s,i):n]}function j(t,e){t.defer((()=>{t.system.scheduler.cancel(t.self,e)}))}function $(t){function e(t,e){}return e.type="xstate.cancel",e.sendId=t,e.resolve=L,e.execute=j,e}function G(t,e,s,i,{id:n,systemId:o,src:r,input:a,syncSnapshot:c}){const h="string"==typeof r?M(e.machine,r):r,u="function"==typeof n?n(s):n;let l;return h&&(l=B(h,{id:u,src:r,parent:t?.self,syncSnapshot:c,systemId:o,input:"function"==typeof a?a({context:e.context,event:s.event,self:t?.self}):a})),[Wt(e,{children:{...e.children,[u]:l}}),{id:n,actorRef:l}]}function H(t,{id:e,actorRef:s}){s&&t.defer((()=>{s._processingStatus!==R.Stopped&&s.start()}))}function V(...[t,{id:e,systemId:s,input:i,syncSnapshot:n=!1}={}]){function o(t,e){}return o.type="snapshot.spawnChild",o.id=e,o.systemId=s,o.src=t,o.input=i,o.syncSnapshot=n,o.resolve=G,o.execute=H,o}function U(t,e,s,i,{actorRef:n}){const o="function"==typeof n?n(s,i):n,r="string"==typeof o?e.children[o]:o;let a=e.children;return r&&(a={...a},delete a[r.id]),[Wt(e,{children:a}),r]}function F(t,e){e&&(t.system._unregister(e),e._processingStatus===R.Running?t.defer((()=>{t.stopChild(e)})):t.stopChild(e))}function W(t){function e(t,e){}return e.type="xstate.stopChild",e.actorRef=t,e.resolve=U,e.execute=F,e}const q=W;function Y(t,e,{stateValue:s}){if("string"==typeof s&&ut(s)){const e=t.machine.getStateNodeById(s);return t._nodes.some((t=>t===e))}return t.matches(s)}function z(t){function e(t,e){return!1}return e.check=Y,e.stateValue=t,e}function J(t,{context:e,event:s},{guards:i}){return!et(i[0],e,s,t)}function X(t){function e(t,e){return!1}return e.check=J,e.guards=[t],e}function Z(t,{context:e,event:s},{guards:i}){return i.every((i=>et(i,e,s,t)))}function K(t){function e(t,e){return!1}return e.check=Z,e.guards=t,e}function Q(t,{context:e,event:s},{guards:i}){return i.some((i=>et(i,e,s,t)))}function tt(t){function e(t,e){return!1}return e.check=Q,e.guards=t,e}function et(t,e,s,i){const{machine:n}=i,o="function"==typeof t,r=o?t:n.implementations.guards["string"==typeof t?t:t.type];if(!o&&!r)throw new Error(`Guard '${"string"==typeof t?t:t.type}' is not implemented.'.`);if("function"!=typeof r)return et(r,e,s,i);const a={context:e,event:s},c=o||"string"==typeof t?void 0:"params"in t?"function"==typeof t.params?t.params({context:e,event:s}):t.params:void 0;return"check"in r?r.check(i,a,r):r(a,c)}const st=t=>"atomic"===t.type||"final"===t.type;function it(t){return Object.values(t.states).filter((t=>"history"!==t.type))}function nt(t,e){const s=[];if(e===t)return s;let i=t.parent;for(;i&&i!==e;)s.push(i),i=i.parent;return s}function ot(t){const e=new Set(t),s=at(e);for(const t of e)if("compound"!==t.type||s.get(t)&&s.get(t).length){if("parallel"===t.type)for(const s of it(t))if("history"!==s.type&&!e.has(s)){const t=ft(s);for(const s of t)e.add(s)}}else ft(t).forEach((t=>e.add(t)));for(const t of e){let s=t.parent;for(;s;)e.add(s),s=s.parent}return e}function rt(t,e){const s=e.get(t);if(!s)return{};if("compound"===t.type){const t=s[0];if(!t)return{};if(st(t))return t.key}const i={};for(const t of s)i[t.key]=rt(t,e);return i}function at(t){const e=new Map;for(const s of t)e.has(s)||e.set(s,[]),s.parent&&(e.has(s.parent)||e.set(s.parent,[]),e.get(s.parent).push(s));return e}function ct(t,e){return rt(t,at(ot(e)))}function ht(t,e){return"compound"===e.type?it(e).some((e=>"final"===e.type&&t.has(e))):"parallel"===e.type?it(e).every((e=>ht(t,e))):"final"===e.type}const ut=t=>"#"===t[0];function lt(t,e,s){const i=I(s.target),n=s.reenter??!1,r=function(t,e){if(void 0!==e)return e.map((e=>{if("string"!=typeof e)return e;if(ut(e))return t.machine.getStateNodeById(e);const s=e[0]===o;if(s&&!t.parent)return vt(t,e.slice(1));const i=s?t.key+e:e;if(!t.parent)throw new Error(`Invalid target: "${e}" is not a valid target from the root node. Did you mean ".${e}"?`);try{return vt(t.parent,i)}catch(e){throw new Error(`Invalid transition definition for state node '${t.id}':\n${e.message}`)}}))}(t,i),a={...s,actions:b(s.actions),guard:s.guard,target:r,source:t,reenter:n,eventType:e,toJSON:()=>({...a,source:`#${t.id}`,target:r?r.map((t=>`#${t.id}`)):void 0})};return a}function dt(t){const e=I(t.config.target);return e?{target:e.map((e=>"string"==typeof e?vt(t.parent,e):e))}:t.parent.initial}function pt(t){return"history"===t.type}function ft(t){const e=yt(t);for(const s of e)for(const i of nt(s,t))e.add(i);return e}function yt(t){const e=new Set;return function t(s){if(!e.has(s))if(e.add(s),"compound"===s.type)t(s.initial.target[0]);else if("parallel"===s.type)for(const e of it(s))t(e)}(t),e}function gt(t,e){if(ut(e))return t.machine.getStateNodeById(e);if(!t.states)throw new Error(`Unable to retrieve child state '${e}' from '${t.id}'; no child states exist.`);const s=t.states[e];if(!s)throw new Error(`Child state '${e}' does not exist on '${t.id}'`);return s}function vt(t,e){if("string"==typeof e&&ut(e))try{return t.machine.getStateNodeById(e)}catch(t){}const s=_(e).slice();let i=t;for(;s.length;){const t=s.shift();if(!t.length)break;i=gt(i,t)}return i}function _t(t,e){if("string"==typeof e)return[t,t.states[e]];const s=Object.keys(e),i=s.map((e=>gt(t,e))).filter(Boolean);return[t.machine.root,t].concat(i,s.reduce(((s,i)=>{const n=gt(t,i);if(!n)return s;const o=_t(n,e[i]);return s.concat(o)}),[]))}function mt(t,e,s,i){return"string"==typeof e?function(t,e,s,i){const n=gt(t,e).next(s,i);return n&&n.length?n:t.next(s,i)}(t,e,s,i):1===Object.keys(e).length?function(t,e,s,i){const n=Object.keys(e),o=mt(gt(t,n[0]),e[n[0]],s,i);return o&&o.length?o:t.next(s,i)}(t,e,s,i):function(t,e,s,i){const n=[];for(const o of Object.keys(e)){const r=e[o];if(!r)continue;const a=mt(gt(t,o),r,s,i);a&&n.push(...a)}return n.length?n:t.next(s,i)}(t,e,s,i)}function xt(t){return Object.keys(t.states).map((e=>t.states[e])).filter((t=>"history"===t.type))}function St(t,e){let s=t;for(;s.parent&&s.parent!==e;)s=s.parent;return s.parent===e}function Tt(t,e){const s=new Set(t),i=new Set(e);for(const t of s)if(i.has(t))return!0;for(const t of i)if(s.has(t))return!0;return!1}function bt(t,e,s){const i=new Set;for(const n of t){let t=!1;const o=new Set;for(const r of i)if(Tt(Pt([n],e,s),Pt([r],e,s))){if(!St(n.source,r.source)){t=!0;break}o.add(r)}if(!t){for(const t of o)i.delete(t);i.add(n)}}return Array.from(i)}function Et(t,e){if(!t.target)return[];const s=new Set;for(const i of t.target)if(pt(i))if(e[i.id])for(const t of e[i.id])s.add(t);else for(const t of Et(dt(i),e))s.add(t);else s.add(i);return[...s]}function wt(t,e){const s=Et(t,e);if(!s)return;if(!t.reenter&&s.every((e=>e===t.source||St(e,t.source))))return t.source;return function(t){const[e,...s]=t;for(const t of nt(e,void 0))if(s.every((e=>St(e,t))))return t}(s.concat(t.source))||(t.reenter?void 0:t.source.machine.root)}function Pt(t,e,s){const i=new Set;for(const n of t)if(n.target?.length){const t=wt(n,s);n.reenter&&n.source===t&&i.add(t);for(const s of e)St(s,t)&&i.add(s)}return[...i]}function It(t,e,s,i,n,o){if(!t.length)return e;const r=new Set(e._nodes);let a=e.historyValue;const c=bt(t,r,a);let h=e;n||([h,a]=function(t,e,s,i,n,o,r){let a=t;const c=Pt(i,n,o);let h;c.sort(((t,e)=>e.order-t.order));for(const t of c)for(const e of xt(t)){let s;s="deep"===e.history?e=>st(e)&&St(e,t):e=>e.parent===t,h??={...o},h[e.id]=Array.from(n).filter(s)}for(const t of c)a=Nt(a,e,s,[...t.exit,...t.invoke.map((t=>W(t.id)))],r),n.delete(t);return[a,h||o]}(h,i,s,c,r,a,o)),h=Nt(h,i,s,c.flatMap((t=>t.actions)),o),h=function(t,e,s,i,n,o,r,a){let c=t;const h=new Set,l=new Set;(function(t,e,s,i){for(const n of t){const t=wt(n,e);for(const o of n.target||[])pt(o)||n.source===o&&n.source===t&&!n.reenter||(i.add(o),s.add(o)),At(o,e,s,i);const o=Et(n,e);for(const r of o){const o=nt(r,t);"parallel"===t?.type&&o.push(t),Mt(i,e,s,o,!n.source.parent&&n.reenter?void 0:t)}}})(i,r,l,h),a&&l.add(t.machine.root);const d=new Set;for(const t of[...h].sort(((t,e)=>t.order-e.order))){n.add(t);const i=[];i.push(...t.entry);for(const e of t.invoke)i.push(V(e.src,{...e,syncSnapshot:!!e.onSnapshot}));if(l.has(t)){const e=t.initial.actions;i.push(...e)}if(c=Nt(c,e,s,i,o,t.invoke.map((t=>t.id))),"final"===t.type){const i=t.parent;let r="parallel"===i?.type?i:i?.parent,a=r||t;for("compound"===i?.type&&o.push(u(i.id,t.output?E(t.output,c.context,e,s.self):void 0));"parallel"===r?.type&&!d.has(r)&&ht(n,r);)d.add(r),o.push(u(r.id)),a=r,r=r.parent;if(r)continue;c=Wt(c,{status:"done",output:Ot(c,e,s,c.machine.root,a)})}}return c}(h,i,s,c,r,o,a,n);const l=[...r];"done"===h.status&&(h=Nt(h,i,s,l.sort(((t,e)=>e.order-t.order)).flatMap((t=>t.exit)),o));try{return a===e.historyValue&&function(t,e){if(t.length!==e.size)return!1;for(const s of t)if(!e.has(s))return!1;return!0}(e._nodes,r)?h:Wt(h,{_nodes:l,historyValue:a})}catch(t){throw t}}function Ot(t,e,s,i,n){if(!i.output)return;const o=u(n.id,n.output&&n.parent?E(n.output,t.context,e,s.self):void 0);return E(i.output,t.context,o,s.self)}function At(t,e,s,i){if(pt(t))if(e[t.id]){const n=e[t.id];for(const t of n)i.add(t),At(t,e,s,i);for(const o of n)kt(o,t.parent,i,e,s)}else{const n=dt(t);for(const o of n.target)i.add(o),n===t.parent?.initial&&s.add(t.parent),At(o,e,s,i);for(const o of n.target)kt(o,t,i,e,s)}else if("compound"===t.type){const[n]=t.initial.target;pt(n)||(i.add(n),s.add(n)),At(n,e,s,i),kt(n,t,i,e,s)}else if("parallel"===t.type)for(const n of it(t).filter((t=>!pt(t))))[...i].some((t=>St(t,n)))||(pt(n)||(i.add(n),s.add(n)),At(n,e,s,i))}function Mt(t,e,s,i,n){for(const o of i)if(n&&!St(o,n)||t.add(o),"parallel"===o.type)for(const i of it(o).filter((t=>!pt(t))))[...t].some((t=>St(t,i)))||(t.add(i),At(i,e,s,t))}function kt(t,e,s,i,n){Mt(s,i,n,nt(t,e))}function Rt(t,e,s,i,n,o){const{machine:r}=t;let a=t;for(const t of i){const i="function"==typeof t,c=i?t:r.implementations.actions["string"==typeof t?t:t.type];if(!c)continue;const h={context:a.context,event:e,self:s?.self,system:s?.system},u=i||"string"==typeof t?void 0:"params"in t?"function"==typeof t.params?t.params({context:a.context,event:e}):t.params:void 0;if(!("resolve"in c)){s?.self._processingStatus===R.Running?c(h,u):s?.defer((()=>{c(h,u)}));continue}const l=c,[d,p,f]=l.resolve(s,a,h,u,c,n);a=d,"retryResolve"in l&&o?.push([l,p]),"execute"in l&&(s?.self._processingStatus===R.Running?l.execute(s,p):s?.defer(l.execute.bind(null,s,p))),f&&(a=Rt(a,e,s,f,n,o))}return a}function Nt(t,e,s,i,n,o){const r=o?[]:void 0,a=Rt(t,e,s,i,{internalQueue:n,deferredActorIds:o},r);return r?.forEach((([t,e])=>{t.retryResolve(s,a,e)})),a}function Dt(t,e,s,i=[]){let n=t;const o=[];if(e.type===h)return n=Wt(Bt(n,e,s),{status:"stopped"}),o.push(n),{snapshot:n,microstates:o};let r=e;if(r.type!==a){const e=r,a=function(t){return t.type.startsWith("xstate.error.actor")}(e),c=Ct(e,n);if(a&&!c.length)return n=Wt(t,{status:"error",error:e.error}),o.push(n),{snapshot:n,microstates:o};n=It(c,t,s,r,!1,i),o.push(n)}let c=!0;for(;"active"===n.status;){let t=c?Lt(n,r):[];const e=t.length?n:void 0;if(!t.length){if(!i.length)break;r=i.shift(),t=Ct(r,n)}n=It(t,n,s,r,!1,i),c=n!==e,o.push(n)}return"active"!==n.status&&Bt(n,r,s),{snapshot:n,microstates:o}}function Bt(t,e,s){return Nt(t,e,s,Object.values(t.children).map((t=>W(t))),[])}function Ct(t,e){return e.machine.getTransitionData(e,t)}function Lt(t,e){const s=new Set,i=t._nodes.filter(st);for(const n of i)t:for(const i of[n].concat(nt(n,void 0)))if(i.always)for(const n of i.always)if(void 0===n.guard||et(n.guard,t.context,e,t)){s.add(n);break t}return bt(Array.from(s),new Set(t._nodes),t.historyValue)}function jt(t){return!!t&&"object"==typeof t&&"machine"in t&&"value"in t}const $t=function(t){return v(t,this.value)},Gt=function(t){return this.tags.has(t)},Ht=function(t){const e=this.machine.getTransitionData(this,t);return!!e?.length&&e.some((t=>void 0!==t.target||t.actions.length))},Vt=function(){const{_nodes:t,tags:e,machine:s,getMeta:i,toJSON:n,can:o,hasTag:r,matches:a,...c}=this;return{...c,tags:Array.from(e)}},Ut=function(){return this._nodes.reduce(((t,e)=>(void 0!==e.meta&&(t[e.id]=e.meta),t)),{})};function Ft(t,e){return{status:t.status,output:t.output,error:t.error,machine:e,context:t.context,_nodes:t._nodes,value:ct(e.root,t._nodes),tags:new Set(t._nodes.flatMap((t=>t.tags))),children:t.children,historyValue:t.historyValue||{},matches:$t,hasTag:Gt,can:Ht,getMeta:Ut,toJSON:Vt}}function Wt(t,e={}){return Ft({...t,...e},t.machine)}function qt(t){let e;for(const s in t){const i=t[s];if(i&&"object"==typeof i)if("sessionId"in i&&"send"in i&&"ref"in i)e??=Array.isArray(t)?t.slice():{...t},e[s]={xstate$$type:1,id:i.id};else{const n=qt(i);n!==i&&(e??=Array.isArray(t)?t.slice():{...t},e[s]=n)}}return e??t}function Yt(t,e,s,i,{event:n,id:o,delay:r},{internalQueue:a}){const c=e.machine.implementations.delays;if("string"==typeof n)throw new Error(`Only event objects may be used with raise; use raise({ type: "${n}" }) instead`);const h="function"==typeof n?n(s,i):n;let u;if("string"==typeof r){const t=c&&c[r];u="function"==typeof t?t(s,i):t}else u="function"==typeof r?r(s,i):r;return"number"!=typeof u&&a.push(h),[e,{event:h,id:o,delay:u}]}function zt(t,e){const{event:s,delay:i,id:n}=e;"number"!=typeof i||t.defer((()=>{const e=t.self;t.system.scheduler.schedule(e,e,s,i,n)}))}function Jt(t,e){function s(t,e){}return s.type="xstate.raise",s.event=t,s.id=e?.id,s.delay=e?.delay,s.resolve=Yt,s.execute=zt,s}function Xt(t,e){return{config:t,transition:(e,s,i)=>({...e,context:t(e.context,s,i)}),getInitialSnapshot:(t,s)=>({status:"active",output:void 0,error:void 0,context:"function"==typeof e?e({input:s}):e}),getPersistedSnapshot:t=>t,restoreSnapshot:t=>t}}const Zt=new WeakMap;function Kt(t){return{config:t,start:(e,s)=>{const{self:i,system:n}=s,o={receivers:void 0,dispose:void 0};Zt.set(i,o),o.dispose=t({input:e.input,system:n,self:i,sendBack:t=>{"stopped"!==i.getSnapshot().status&&i._parent&&n._relay(i,i._parent,t)},receive:t=>{o.receivers??=new Set,o.receivers.add(t)}})},transition:(t,e,s)=>{const i=Zt.get(s.self);return e.type===h?(t={...t,status:"stopped",error:void 0},i.dispose?.(),t):(i.receivers?.forEach((t=>t(e))),t)},getInitialSnapshot:(t,e)=>({status:"active",output:void 0,error:void 0,input:e}),getPersistedSnapshot:t=>t,restoreSnapshot:t=>t}}const Qt="xstate.observable.next",te="xstate.observable.error",ee="xstate.observable.complete";function se(t){return{config:t,transition:(t,e,{self:s,id:i,defer:n,system:o})=>{if("active"!==t.status)return t;switch(e.type){case Qt:return{...t,context:e.data};case te:return{...t,status:"error",error:e.data,input:void 0,_subscription:void 0};case ee:return{...t,status:"done",input:void 0,_subscription:void 0};case h:return t._subscription.unsubscribe(),{...t,status:"stopped",input:void 0,_subscription:void 0};default:return t}},getInitialSnapshot:(t,e)=>({status:"active",output:void 0,error:void 0,context:void 0,input:e,_subscription:void 0}),start:(e,{self:s,system:i})=>{"done"!==e.status&&(e._subscription=t({input:e.input,system:i,self:s}).subscribe({next:t=>{i._relay(s,s,{type:Qt,data:t})},error:t=>{i._relay(s,s,{type:te,data:t})},complete:()=>{i._relay(s,s,{type:ee})}}))},getPersistedSnapshot:({_subscription:t,...e})=>e,restoreSnapshot:t=>({...t,_subscription:void 0})}}function ie(t){return{config:t,transition:(t,e)=>{if("active"!==t.status)return t;switch(e.type){case te:return{...t,status:"error",error:e.data,input:void 0,_subscription:void 0};case ee:return{...t,status:"done",input:void 0,_subscription:void 0};case h:return t._subscription.unsubscribe(),{...t,status:"stopped",input:void 0,_subscription:void 0};default:return t}},getInitialSnapshot:(t,e)=>({status:"active",output:void 0,error:void 0,context:void 0,input:e,_subscription:void 0}),start:(e,{self:s,system:i})=>{"done"!==e.status&&(e._subscription=t({input:e.input,system:i,self:s}).subscribe({next:t=>{s._parent&&i._relay(s,s._parent,t)},error:t=>{i._relay(s,s,{type:te,data:t})},complete:()=>{i._relay(s,s,{type:ee})}}))},getPersistedSnapshot:({_subscription:t,...e})=>e,restoreSnapshot:t=>({...t,_subscription:void 0})}}const ne="xstate.promise.resolve",oe="xstate.promise.reject";function re(t){return{config:t,transition:(t,e)=>{if("active"!==t.status)return t;switch(e.type){case ne:{const s=e.data;return{...t,status:"done",output:s,input:void 0}}case oe:return{...t,status:"error",error:e.data,input:void 0};case h:return{...t,status:"stopped",input:void 0};default:return t}},start:(e,{self:s,system:i})=>{"active"===e.status&&Promise.resolve(t({input:e.input,system:i,self:s})).then((t=>{"active"===s.getSnapshot().status&&i._relay(s,s,{type:ne,data:t})}),(t=>{"active"===s.getSnapshot().status&&i._relay(s,s,{type:oe,data:t})}))},getInitialSnapshot:(t,e)=>({status:"active",output:void 0,error:void 0,input:e}),getPersistedSnapshot:t=>t,restoreSnapshot:t=>t}}const ae=Xt((t=>{}),void 0);function ce(){return B(ae)}function he(t,{machine:e,context:s},i,n){return(o,r)=>{const a=((o,r={})=>{const{systemId:a,input:c}=r;if("string"==typeof o){const h=M(e,o);if(!h)throw new Error(`Actor logic '${o}' not implemented in machine '${e.id}'`);const u=B(h,{id:r.id,parent:t.self,syncSnapshot:r.syncSnapshot,input:"function"==typeof c?c({context:s,event:i,self:t.self}):c,src:o,systemId:a});return n[u.id]=u,u}return B(o,{id:r.id,parent:t.self,syncSnapshot:r.syncSnapshot,input:r.input,src:o,systemId:a})})(o,r);return n[a.id]=a,t.defer((()=>{a._processingStatus!==R.Stopped&&a.start()})),a}}function ue(t,e,s,i,{assignment:n}){if(!e.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const o={},r={context:e.context,event:s.event,spawn:he(t,e,s.event,o),self:t?.self,system:t?.system};let a={};if("function"==typeof n)a=n(r,i);else for(const t of Object.keys(n)){const e=n[t];a[t]="function"==typeof e?e(r,i):e}return[Wt(e,{context:Object.assign({},e.context,a),children:Object.keys(o).length?{...e.children,...o}:e.children})]}function le(t){function e(t,e){}return e.type="xstate.assign",e.assignment=t,e.resolve=ue,e}let de=function(t){return t.Parent="#_parent",t.Internal="#_internal",t}({});function pe(t,e,s,i,{to:n,event:o,id:r,delay:a},c){const h=e.machine.implementations.delays;if("string"==typeof o)throw new Error(`Only event objects may be used with sendTo; use sendTo({ type: "${o}" }) instead`);const u="function"==typeof o?o(s,i):o;let l;if("string"==typeof a){const t=h&&h[a];l="function"==typeof t?t(s,i):t}else l="function"==typeof a?a(s,i):a;const d="function"==typeof n?n(s,i):n;let p;if("string"==typeof d){if(p=d===de.Parent?t?.self._parent:d===de.Internal?t?.self:d.startsWith("#_")?e.children[d.slice(2)]:c.deferredActorIds?.includes(d)?d:e.children[d],!p)throw new Error(`Unable to send event to actor '${d}' from machine '${e.machine.id}'.`)}else p=d||t?.self;return[e,{to:p,event:u,id:r,delay:l}]}function fe(t,e,s){"string"==typeof s.to&&(s.to=e.children[s.to])}function ye(t,e){t.defer((()=>{const{to:s,event:i,delay:n,id:o}=e;"number"!=typeof n?t.system._relay(t.self,s,i.type===c?l(t.self.id,i.data):i):t.system.scheduler.schedule(t.self,s,i,n,o)}))}function ge(t,e,s){function i(t,e){}return i.type="xsnapshot.sendTo",i.to=t,i.event=e,i.id=s?.id,i.delay=s?.delay,i.resolve=pe,i.retryResolve=fe,i.execute=ye,i}function ve(t,e){return ge(de.Parent,t,e)}function _e(t,e){return ge(t,(({event:t})=>t),e)}function me(t,e,s,i,{collect:n}){const o=[],r=function(t){o.push(t)};return r.assign=(...t)=>{o.push(le(...t))},r.cancel=(...t)=>{o.push($(...t))},r.raise=(...t)=>{o.push(Jt(...t))},r.sendTo=(...t)=>{o.push(ge(...t))},r.spawnChild=(...t)=>{o.push(V(...t))},r.stopChild=(...t)=>{o.push(W(...t))},n({context:s.context,event:s.event,enqueue:r,check:t=>et(t,e.context,s.event,e)}),[e,void 0,o]}function xe(t){function e(t,e){}return e.type="xstate.enqueueActions",e.collect=t,e.resolve=me,e}function Se(t,e,s,i,{value:n,label:o}){return[e,{value:"function"==typeof n?n(s,i):n,label:o}]}function Te({logger:t},{value:e,label:s}){s?t(s,e):t(e)}function be(t=(({context:t,event:e})=>({context:t,event:e})),e){function s(t,e){}return s.type="xstate.log",s.value=t,s.label=e,s.resolve=Se,s.execute=Te,s}class Ee{constructor(){this.timeouts=new Map,this._now=0,this._id=0,this._flushing=!1,this._flushingInvalidated=!1}now(){return this._now}getId(){return this._id++}setTimeout(t,e){this._flushingInvalidated=this._flushing;const s=this.getId();return this.timeouts.set(s,{start:this.now(),timeout:e,fn:t}),s}clearTimeout(t){this._flushingInvalidated=this._flushing,this.timeouts.delete(t)}set(t){if(this._now>t)throw new Error("Unable to travel back in time");this._now=t,this.flushTimeouts()}flushTimeouts(){if(this._flushing)return void(this._flushingInvalidated=!0);this._flushing=!0;const t=[...this.timeouts].sort((([t,e],[s,i])=>{const n=e.start+e.timeout;return i.start+i.timeout>n?-1:1}));for(const[e,s]of t){if(this._flushingInvalidated)return this._flushingInvalidated=!1,this._flushing=!1,void this.flushTimeouts();this.now()-s.start>=s.timeout&&(this.timeouts.delete(e),s.fn.call(null))}this._flushing=!1}increment(t){this._now+=t,this.flushTimeouts()}}const we=new WeakMap;function Pe(t,e,s){let i=we.get(t);return i?e in i||(i[e]=s()):(i={[e]:s()},we.set(t,i)),i[e]}const Ie={},Oe=t=>"string"==typeof t?{type:t}:"function"==typeof t?"resolve"in t?{type:t.type}:{type:t.name}:t;class Ae{constructor(t,e){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(o),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?S(this.config.states,((t,e)=>new Ae(t,{_parent:this,_key:e,_machine:this.machine}))):Ie,"compound"===this.type&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=!0===this.config.history?"shallow":this.config.history||!1,this.entry=b(this.config.entry).slice(),this.exit=b(this.config.exit).slice(),this.meta=this.config.meta,this.output="final"!==this.type&&this.parent?void 0:this.config.output,this.tags=b(t.tags).slice()}_initialize(){this.transitions=function(t){const e=new Map;if(t.config.on)for(const s of Object.keys(t.config.on)){if(""===s)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const i=t.config.on[s];e.set(s,P(i).map((e=>lt(t,s,e))))}if(t.config.onDone){const s=`xstate.done.state.${t.id}`;e.set(s,P(t.config.onDone).map((e=>lt(t,s,e))))}for(const s of t.invoke){if(s.onDone){const i=`xstate.done.actor.${s.id}`;e.set(i,P(s.onDone).map((e=>lt(t,i,e))))}if(s.onError){const i=`xstate.error.actor.${s.id}`;e.set(i,P(s.onError).map((e=>lt(t,i,e))))}if(s.onSnapshot){const i=`xstate.snapshot.${s.id}`;e.set(i,P(s.onSnapshot).map((e=>lt(t,i,e))))}}for(const s of t.after){let t=e.get(s.eventType);t||(t=[],e.set(s.eventType,t)),t.push(s)}return e}(this),this.config.always&&(this.always=P(this.config.always).map((t=>lt(this,"",t)))),Object.keys(this.states).forEach((t=>{this.states[t]._initialize()}))}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(Oe),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map((t=>`#${t.id}`)),source:`#${this.id}`,actions:this.initial.actions.map(Oe),eventType:null})}:void 0,history:this.history,states:S(this.states,(t=>t.definition)),on:this.on,transitions:[...this.transitions.values()].flat().map((t=>({...t,actions:t.actions.map(Oe)}))),entry:this.entry.map(Oe),exit:this.exit.map(Oe),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return Pe(this,"invoke",(()=>b(this.config.invoke).map(((t,e)=>{const{src:s,systemId:i}=t,n=t.id??A(this.id,e),o="string"==typeof s?s:`xstate.invoke.${A(this.id,e)}`;return{...t,src:o,id:n,systemId:i,toJSON(){const{onDone:e,onError:s,...i}=t;return{...i,type:"xstate.invoke",src:o,id:n}}}}))))}get on(){return Pe(this,"on",(()=>[...this.transitions].flatMap((([t,e])=>e.map((e=>[t,e])))).reduce(((t,[e,s])=>(t[e]=t[e]||[],t[e].push(s),t)),{})))}get after(){return Pe(this,"delayedTransitions",(()=>function(t){const e=t.config.after;return e?Object.keys(e).flatMap(((s,i)=>{const n=e[s],o="string"==typeof n?{target:n}:n,r=Number.isNaN(+s)?s:+s,a=((e,s)=>{const i={type:`xstate.after.${e}.${t.id}`},n=i.type;return t.entry.push(Jt(i,{id:n,delay:e})),t.exit.push($(n)),n})(r);return b(o).map((t=>({...t,event:a,delay:r})))})).map((e=>{const{delay:s}=e;return{...lt(t,e.event,e),delay:s}})):[]}(this)))}get initial(){return Pe(this,"initial",(()=>function(t,e){const s="string"==typeof e?t.states[e]:e?t.states[e.target]:void 0;if(!s&&e)throw new Error(`Initial state node "${e}" not found on parent state node #${t.id}`);const i={source:t,actions:e&&"string"!=typeof e?b(e.actions):[],eventType:null,reenter:!1,target:s?[s]:[],toJSON:()=>({...i,source:`#${t.id}`,target:s?[`#${s.id}`]:[]})};return i}(this,this.config.initial)))}next(t,e){const s=e.type,i=[];let n;const o=Pe(this,`candidates-${s}`,(()=>{return e=s,(t=this).transitions.get(e)||[...t.transitions.keys()].filter((t=>{if("*"===t)return!0;if(!t.endsWith(".*"))return!1;const s=t.split("."),i=e.split(".");for(let t=0;t<s.length;t++){const e=s[t],n=i[t];if("*"===e)return t===s.length-1;if(e!==n)return!1}return!0})).sort(((t,e)=>e.length-t.length)).flatMap((e=>t.transitions.get(e)));var t,e}));for(const r of o){const{guard:o}=r,a=t.context;let c=!1;try{c=!o||et(o,a,e,t)}catch(t){const e="string"==typeof o?o:"object"==typeof o?o.type:void 0;throw new Error(`Unable to evaluate guard ${e?`'${e}' `:""}in transition for event '${s}' in state node '${this.id}':\n${t.message}`)}if(c){i.push(...r.actions),n=r;break}}return n?[n]:void 0}get events(){return Pe(this,"events",(()=>{const{states:t}=this,e=new Set(this.ownEvents);if(t)for(const s of Object.keys(t)){const i=t[s];if(i.states)for(const t of i.events)e.add(`${t}`)}return Array.from(e)}))}get ownEvents(){const t=new Set([...this.transitions.keys()].filter((t=>this.transitions.get(t).some((t=>!(!t.target&&!t.actions.length&&!t.reenter))))));return Array.from(t)}}class Me{constructor(t,e){this.config=t,this.version=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.__TResolvedTypesMeta=void 0,this.id=t.id||"(machine)",this.implementations={actors:e?.actors??{},actions:e?.actions??{},delays:e?.delays??{},guards:e?.guards??{}},this.version=this.config.version,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new Ae(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:e,guards:s,actors:i,delays:n}=this.implementations;return new Me(this.config,{actions:{...e,...t.actions},guards:{...s,...t.guards},actors:{...i,...t.actors},delays:{...n,...t.delays}})}resolveState(t){const e=ct(s=this.root,[...ot(_t(s,t.value))]);var s;const i=ot(_t(this.root,e));return Ft({_nodes:[...i],context:t.context||{},children:{},status:ht(i,this.root)?"done":t.status||"active",output:t.output,error:t.error,historyValue:t.historyValue},this)}transition(t,e,s){return Dt(t,e,s).snapshot}microstep(t,e,s){return Dt(t,e,s).microstates}getTransitionData(t,e){return mt(this.root,t.value,t,e)||[]}getPreInitialState(t,e,s){const{context:i}=this.config,n=Ft({context:"function"!=typeof i&&i?i:{},_nodes:[this.root],children:{},status:"active"},this);return"function"==typeof i?Nt(n,e,t,[le((({spawn:t,event:e})=>i({spawn:t,input:e.input})))],s):n}getInitialSnapshot(t,e){const s=d(e),i=[],n=this.getPreInitialState(t,s,i),o=It([{target:[...yt(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],n,t,s,!0,i),{snapshot:r}=Dt(o,s,t,i);return r}start(t){Object.values(t.children).forEach((t=>{"active"===t.getSnapshot().status&&t.start()}))}getStateNodeById(t){const e=t.split(o),s=e.slice(1),i=ut(e[0])?e[0].slice(1):e[0],n=this.idMap.get(i);if(!n)throw new Error(`Child state node '#${i}' does not exist on machine '${this.id}'`);return vt(n,s)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(t,e){return function(t,e){const{_nodes:s,tags:i,machine:n,children:o,context:r,can:a,hasTag:c,matches:h,getMeta:u,toJSON:l,...d}=t,p={};for(const t in o){const s=o[t];p[t]={snapshot:s.getPersistedSnapshot(e),src:s.src,systemId:s._systemId,syncSnapshot:s._syncSnapshot}}return{...d,context:qt(r),children:p}}(t,e)}restoreSnapshot(t,e){const s={},i=t.children;Object.keys(i).forEach((t=>{const n=i[t],o=n.snapshot,r=n.src,a="string"==typeof r?M(this,r):r;if(!a)return;const c=B(a,{id:t,parent:e?.self,syncSnapshot:n.syncSnapshot,snapshot:o,src:r,systemId:n.systemId});s[t]=c}));const n=Ft({...t,children:s,_nodes:Array.from(ot(_t(this.root,t.value)))},this);let o=new Set;return function t(e,s){if(!o.has(e)){o.add(e);for(let i in e){const n=e[i];if(n&&"object"==typeof n){if("xstate$$type"in n&&1===n.xstate$$type){e[i]=s[n.id];continue}t(n,s)}}}}(n.context,s),n}}const ke={timeout:1/0};function Re(t,e,s){const i={...ke,...s};return new Promise(((s,n)=>{let o=!1;const r=i.timeout===1/0?void 0:setTimeout((()=>{h.unsubscribe(),n(new Error(`Timeout of ${i.timeout} ms exceeded`))}),i.timeout),a=()=>{clearTimeout(r),o=!0,h?.unsubscribe()};function c(t){e(t)&&(a(),s(t))}let h;c(t.getSnapshot()),o||(h=t.subscribe({next:c,error:t=>{a(),n(t)},complete:()=>{a(),n(new Error("Actor terminated without satisfying predicate"))}}),o&&h.unsubscribe())}))}function Ne(t,e){return new Me(t,e)}function De({actors:t,actions:e,guards:s,delays:i}){return{createMachine:n=>Ne(n,{actors:t,actions:e,guards:s,delays:i})}}function Be(t){return new Promise(((e,s)=>{t.subscribe({complete:()=>{e(t.getSnapshot().output)},error:s})}))}}},e={};function s(i){var n=e[i];if(void 0!==n)return n.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,s),o.exports}s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=s(239);class e{constructor(t){this.pong=t}setup(){this.pong.setup(),this.gameLoop()}gameLoop(){requestAnimationFrame(this.gameLoop.bind(this)),this.pong.render()}}window.onload=()=>{document.fonts.ready.then((function(){new e(new t.default).setup()}))}})()})();